# =============================================================================
# FILE: automations.yaml
# VERSION: 2026.02.14.25
# =============================================================================

- alias: "Automated-Temp-Control"
  id: hvac_pse_ai_integrated_new
  trigger:
    - platform: time_pattern
      minutes: "/5"
    - platform: state
      entity_id: 
        - binary_sensor.home_occupancy
        - input_boolean.hvac_automation_enabled
  action:
    - variables:
        mode_val: "{% if is_state('input_boolean.hvac_automation_enabled', 'on') %}AI{% else %}MAN{% endif %}"
        occ_status: "{% if is_state('binary_sensor.home_occupancy', 'on') %}Occupied{% else %}Idle{% endif %}"
        new_status: "Furnace | {{ occ_status }} | -- | {{ mode_val }}"
    
    - if:
        - condition: template
          value_template: "{{ states('input_text.hvac_last_action_db') != new_status }}"
      then:
        - service: input_text.set_value
          target:
            entity_id: input_text.hvac_last_action_db
          data:
            value: "{{ new_status }}"

    - if:
        - condition: state
          entity_id: input_boolean.hvac_automation_enabled
          state: "on"
      then:
        - service: climate.set_temperature
          target: { entity_id: climate.home }
          data:
            temperature: >
              {% if is_state('binary_sensor.home_occupancy', 'on') %} 68 {% else %} 65 {% endif %}

    - if:
        - condition: state
          entity_id: binary_sensor.bedroom_occupancy
          state: "on"
      then:
        - service: climate.set_temperature
          target: { entity_id: climate.della_mini_master_bedroom }
          data: { temperature: 68 }

- alias: "Furnace: Restore Schedule"
  id: furnace_restore_default
  trigger:
    - platform: state
      entity_id: input_boolean.hvac_automation_enabled
      to: "off"
  action:
    - service: button.press
      target: { entity_id: button.home_clear_hold }
    - service: input_text.set_value
      target: { entity_id: input_text.hvac_last_action_db }
      data: { value: "Furnace | Manual | -- | MAN" }
